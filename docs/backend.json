{
  "entities": {
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "orderTime": {
          "type": "string",
          "description": "The date and time the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the order (Waiting, Cooking, Done).",
          "format": "string"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "menuItemIds": {
          "type": "array",
          "description": "References to MenuItems. (Relationship: Order N:N MenuItem)",
          "items": {
            "type": "string"
          }
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        }
      },
      "required": [
        "id",
        "orderTime",
        "status",
        "totalAmount",
        "menuItemIds",
        "customerId"
      ]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuItem",
      "type": "object",
      "description": "Represents an item on the restaurant's menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu item."
        },
        "name": {
          "type": "string",
          "description": "The name of the menu item."
        },
        "description": {
          "type": "string",
          "description": "A description of the menu item."
        },
        "price": {
          "type": "number",
          "description": "The price of the menu item."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of image of the menu item.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "name": {
          "type": "string",
          "description": "The name of the customer."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer data. Used for profile information and authentication.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders associated with a customer. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/menu_items/{menuItemId}",
        "definition": {
          "entityName": "MenuItem",
          "schema": {
            "$ref": "#/backend/entities/MenuItem"
          },
          "description": "Stores menu items available in the restaurant.",
          "params": [
            {
              "name": "menuItemId",
              "description": "The unique identifier for the menu item."
            }
          ]
        }
      },
      {
        "path": "/roles_staff/{uid}",
        "definition": {
          "entityName": "StaffRole",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Indicates Staff Roles.  Existence over content.",
          "params": [
            {
              "name": "uid",
              "description": "Firebase Auth UID of the staff member."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the ZestyDash application. It leverages path-based ownership for customer-related data and a membership map approach for collaborative data, specifically for staff roles. Denormalization is heavily used to avoid `get()` calls in security rules. The structure also supports the required QAPs. The segregation into separate collections based on ownership/access patterns is key to rule simplicity.\n\n1.  **Orders:** Orders are stored under the customer's document (`/customers/{customerId}/orders/{orderId}`). This establishes clear ownership. The `customerId` is denormalized to the order document itself, enabling rules to be based solely on `request.auth.uid` and data within the document, without requiring `get()` calls.\n2.  **Menu Items:** Menu items are stored in a top-level collection `/menu_items/{menuItemId}`.  Since menu items are globally accessible, no user-specific ownership is needed.  `list` operations are inherently secure.\n3.  **Customers:** Customers are stored in the `/customers/{customerId}` collection. Orders will be nested under each customer document.\n4. **Staff Roles:** A separate collection `/roles_staff/{uid}` is used to manage staff roles. The existence of a document is used to authorize staff actions.  This avoids complex content-based checks in rules.\n\nThis design avoids hierarchical authorization dependencies. Each collection stands alone with respect to security rules. This dramatically simplifies the rules and ensures atomic operations. The structure enables secure `list` operations and maintains data integrity through clear ownership and explicit state modeling."
  }
}